/******************************************************************************
 * This program is protected under international and U.S. copyright laws as
 * an unpublished work. This program is confidential and proprietary to the
 * copyright owners. Reproduction or disclosure, in whole or in part, or the
 * production of derivative works therefrom without the express permission of
 * the copyright owners is prohibited.
 *
 *              Copyright (C) 2017 by Dolby International AB.
 *                            All rights reserved.
 ******************************************************************************/

/**
 * @brief For the AC-4 Split Security solution, setup the session
 *        parameters for table retrieval
 *
 * @return DLB_AC4DEC_OK on success
 */

#ifndef TABLEXINIT_H
#define TABLEXINIT_H

#include <iostream>
#include <memory>

/* Put in macro here */

#define LUT_BUFFER_SIZE             (256)
#define MAX_BUFFER_SIZE             LUT_BUFFER_SIZE

#define TABLE_B_C_U8_SZ             (80)
#define TABLE_A_U32_SZ              (64)

/* Table Identifiers */
#define AC4_TABLE_SEC_FRS_CODE      0x09
#define AC4_TABLE_SEC_MDD_MAX_FRAM  0x0A
#define AC4_TABLE_SEC_MDD_MAX_INST  0x0B

/* Session Mask Parameters */
#define AC4_TABLE_SEC_FRS_MASK_VAL  0x0
#define AC4_TABLE_SEC_MMF_MASK_VAL  0x4
#define AC4_TABLE_SEC_MMI_MASK_VAL  0x8

static unsigned char _table_a_u8[LUT_BUFFER_SIZE] = {

/*0*/  0x7F,0xF8,0xFF,0xFF, 0xFC,0xFF,0xFF,0xFF, 0xF5,0xFF,0xFF,0xFF, 0xFD,0xFF,0xFF,0xFF,
/*1*/  0x7F,0xF8,0xFF,0xFF, 0xFC,0xFF,0xFF,0xFF, 0xF5,0xFF,0xFF,0xFF, 0xFE,0xFF,0xFF,0xFF,
/*2*/  0xFF,0xF7,0xFF,0xFF, 0xFB,0xFF,0xFF,0xFF, 0xF7,0xFF,0xFF,0xFF, 0xFF,0xFF,0xFF,0xFF,
/*3*/  0xFF,0xF9,0xFF,0xFF, 0xF9,0xFF,0xFF,0xFF, 0xFB,0xFF,0xFF,0xFF, 0xFD,0xFF,0xFF,0xFF,
/*4*/  0xFF,0xF9,0xFF,0xFF, 0xF9,0xFF,0xFF,0xFF, 0xFB,0xFF,0xFF,0xFF, 0xFE,0xFF,0xFF,0xFF,
/*5*/  0x3F,0xFC,0xFF,0xFF, 0xFC,0xFF,0xFF,0xFF, 0xFA,0xFF,0xFF,0xFF, 0xFD,0xFF,0xFF,0xFF,
/*6*/  0x3F,0xFC,0xFF,0xFF, 0xFC,0xFF,0xFF,0xFF, 0xFA,0xFF,0xFF,0xFF, 0xFE,0xFF,0xFF,0xFF,
/*7*/  0xFF,0xFB,0xFF,0xFF, 0xFB,0xFF,0xFF,0xFF, 0xFB,0xFF,0xFF,0xFF, 0xFF,0xFF,0xFF,0xFF,
/*8*/  0xFF,0xFC,0xFF,0xFF, 0xF9,0xFF,0xFF,0xFF, 0xFD,0xFF,0xFF,0xFF, 0xFD,0xFF,0xFF,0xFF,
/*9*/  0xFF,0xFC,0xFF,0xFF, 0xF9,0xFF,0xFF,0xFF, 0xFD,0xFF,0xFF,0xFF, 0xFE,0xFF,0xFF,0xFF,
/*10*/ 0xFF,0xFD,0xFF,0xFF, 0xFB,0xFF,0xFF,0xFF, 0xFD,0xFF,0xFF,0xFF, 0xFF,0xFF,0xFF,0xFF,
/*11*/ 0x7F,0xFE,0xFF,0xFF, 0xF9,0xFF,0xFF,0xFF, 0xFE,0xFF,0xFF,0xFF, 0xFD,0xFF,0xFF,0xFF,
/*12*/ 0x7F,0xFE,0xFF,0xFF, 0xF9,0xFF,0xFF,0xFF, 0xFE,0xFF,0xFF,0xFF, 0xFE,0xFF,0xFF,0xFF,
/*13*/ 0xFF,0xF7,0xFF,0xFF, 0xFB,0xFF,0xFF,0xFF, 0xF7,0xFF,0xFF,0xFF, 0xF9,0xFF,0xFF,0xFF,
/*14*/ 0xFF,0xF7,0xFF,0xFF, 0xFB,0xFF,0xFF,0xFF, 0xF7,0xFF,0xFF,0xFF, 0xFC,0xFF,0xFF,0xFF,
/*15*/ 0xFF,0xFF,0xFF,0xFF, 0xFF,0xFF,0xFF,0xFF, 0xFF,0xFF,0xFF,0xFF, 0xFA,0xFF,0xFF,0xFF
};

static unsigned char _table_b_u8[LUT_BUFFER_SIZE] = {
/*0*/  0xF7,0xFF,0xFF,0xFF,
/*1*/  0xFA,0xFF,0xFF,0xFF,
/*2*/  0xFA,0xFF,0xFF,0xFF,
/*3*/  0xFA,0xFF,0xFF,0xFF,
/*4*/  0xFA,0xFF,0xFF,0xFF,
/*5*/  0xFA,0xFF,0xFF,0xFF,
/*6*/  0xFA,0xFF,0xFF,0xFF,
/*7*/  0xFA,0xFF,0xFF,0xFF,
/*8*/  0xFA,0xFF,0xFF,0xFF,
/*9*/  0xFA,0xFF,0xFF,0xFF,
/*10*/ 0xFA,0xFF,0xFF,0xFF,
/*11*/ 0xFA,0xFF,0xFF,0xFF,
/*12*/ 0xFA,0xFF,0xFF,0xFF,
/*13*/ 0xFA,0xFF,0xFF,0xFF,
/*14*/ 0xFA,0xFF,0xFF,0xFF,
/*15*/ 0xFA,0xFF,0xFF,0xFF,
/*16*/ 0xFA,0xFF,0xFF,0xFF,
/*17*/ 0xF7,0xFF,0xFF,0xFF,
/*18*/ 0xF7,0xFF,0xFF,0xFF,
/*19*/ 0xFA,0xFF,0xFF,0xFF,
};

static unsigned char _table_c_u8[TABLE_B_C_U8_SZ] = {
/*0*/  0xFE, 0xFF, 0xFF, 0xFF,
/*1*/  0xFE, 0xFF, 0xFF, 0xFF,
/*2*/  0xF4, 0xFF, 0xFF, 0xFF,
/*3*/  0xF4, 0xFF, 0xFF, 0xFF,
/*4*/  0xF4, 0xFF, 0xFF, 0xFF,
/*5*/  0xFA, 0xFF, 0xFF, 0xFF,
/*6*/  0xFA, 0xFF, 0xFF, 0xFF,
/*7*/  0xFE, 0xFF, 0xFF, 0xFF,
/*8*/  0xFC, 0xFF, 0xFF, 0xFF,
/*9*/  0xFE, 0xFF, 0xFF, 0xFF,
/*10*/ 0xFD, 0xFF, 0xFF, 0xFF,
/*11*/ 0xFD, 0xFF, 0xFF, 0xFF,
/*12*/ 0xFE, 0xFF, 0xFF, 0xFF,
/*13*/ 0xFE, 0xFF, 0xFF, 0xFF,
/*14*/ 0xFE, 0xFF, 0xFF, 0xFF,
/*15*/ 0xFE, 0xFF, 0xFF, 0xFF,
/*16*/ 0xF4, 0xFF, 0xFF, 0xFF,
/*17*/ 0xFE, 0xFF, 0xFF, 0xFF,
/*18*/ 0xFE, 0xFF, 0xFF, 0xFF,
/*19*/ 0xFE, 0xFF, 0xFF, 0xFF
};

static unsigned int scrambled_table[TABLE_A_U32_SZ] = {
      0x18aa9205,0xb9953de4,0x6fc38e9e,0x6c44fe69,
      0x2dcf9356,0x0755aed1,0xf994015f,0x28dc5d10,
      0x0efc3170,0x2486ce80,0x1a4f683a,0xda7ea9bf,
      0xba6747ab,0x65cc8474,0x1b3049af,0xd89d380f,
      0x1535e9e3,0xb4d4ace6,0xbce2eb58,0xa7627839,
      0x21cb3cf3,0x2b52bd11,0x9023a173,0xd9793f51,
      0x22d3767f,0xf487f17a,0x40b02606,0x97d25c0d,
      0x2a6e4de7,0xb699dbb3,0xb15a64a8,0x539f00e0,
      0x43ea19cd,0x6dc24617,0x0298c027,0x50c13ed6,
      0x6b2c16d5,0xdf13710b,0xbee575ad,0x964863f5,
      0xfb29917c,0xec3461b5,0xca36b74a,0x5466a2bb,
      0x088104f6,0x2f8f7bb2,0x9c0cf233,0x208b7d8c,
      0x881d4ea5,0x6077144c,0xff0aa4ef,0x25de45e8,
      0xddb85985,0x5ed009a6,0xc8c5c6ed,0x2e82f7d7,
      0x4172a3fa,0x576ac4f0,0x37e18d1e,0xfd12034b,
      0x5bf8421c,0x9b1f9a83,0x3ba0c7c9,0x32898aee
};

// ---------------------------------------------------------------------------

namespace android {

class TableXInit
{
public:
    /*!
     * Constructors and destructors
     */
    TableXInit(unsigned char table_id, unsigned char mask_val = 0);
    ~TableXInit();

    unsigned char getSeed()
    {
        return _session_seed;
    }

    unsigned char * getBuffer()
    {
        return _buffer;
    }

    unsigned char getTableID()
    {
       return _table_id;
    }

    unsigned char getMaskVal()
    {
       return _mask_val;
    }

    unsigned int getSize()
    {
       return _buffer_size;
    }

    unsigned char isInit()
    {
        return _isTableXInitialized;
    }

    void init();

private:
    unsigned char _table_id;
    unsigned char _mask_val;
    unsigned char _session_seed;
    unsigned int  _buffer_size;

    unsigned char _isTableXInitialized;

    unsigned char _buffer[MAX_BUFFER_SIZE];
};

}; //namespace

#endif //TABLEXINIT_H
